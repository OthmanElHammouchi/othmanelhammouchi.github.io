<!doctype html><html lang=en><head><title>Mumford-Shah Segmentation: Deriving the Equations · Othman El Hammouchi</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Othman El Hammouchi"><meta name=description content="In the previous post, we saw how the Mumford-Shah model finds a segmentation of an image $g$ by solving the variational problem
$$ \underset{(u, k) \in \mathcal{A}}{\rm{argmin}} \, J[u, K] $$
where
$$ \begin{equation} \label{eq:ms-functional} J[u, K] = \int_{\Omega}(u - g)^2 \, dx + \int_{\Omega \setminus K}\left \Vert \nabla u \right \Vert ^2 \, dx + \mathcal{H}^1(K) \end{equation} $$
is the Mumford-Shah functional and
$$ \mathcal{A} = \left \lbrace (u, K) \ \vert \ K \subseteq \Omega \ \text{closed}, \ u \in C^1(\Omega \setminus K) \right \rbrace $$"><meta name=keywords content="blog,developer,data science,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Mumford-Shah Segmentation: Deriving the Equations"><meta name=twitter:description content="In the previous post, we saw how the Mumford-Shah model finds a segmentation of an image $g$ by solving the variational problem
$$ \underset{(u, k) \in \mathcal{A}}{\rm{argmin}} \, J[u, K] $$
where
$$ \begin{equation} \label{eq:ms-functional} J[u, K] = \int_{\Omega}(u - g)^2 \, dx + \int_{\Omega \setminus K}\left \Vert \nabla u \right \Vert ^2 \, dx + \mathcal{H}^1(K) \end{equation} $$
is the Mumford-Shah functional and
$$ \mathcal{A} = \left \lbrace (u, K) \ \vert \ K \subseteq \Omega \ \text{closed}, \ u \in C^1(\Omega \setminus K) \right \rbrace $$"><meta property="og:title" content="Mumford-Shah Segmentation: Deriving the Equations"><meta property="og:description" content="In the previous post, we saw how the Mumford-Shah model finds a segmentation of an image $g$ by solving the variational problem
$$ \underset{(u, k) \in \mathcal{A}}{\rm{argmin}} \, J[u, K] $$
where
$$ \begin{equation} \label{eq:ms-functional} J[u, K] = \int_{\Omega}(u - g)^2 \, dx + \int_{\Omega \setminus K}\left \Vert \nabla u \right \Vert ^2 \, dx + \mathcal{H}^1(K) \end{equation} $$
is the Mumford-Shah functional and
$$ \mathcal{A} = \left \lbrace (u, K) \ \vert \ K \subseteq \Omega \ \text{closed}, \ u \in C^1(\Omega \setminus K) \right \rbrace $$"><meta property="og:type" content="article"><meta property="og:url" content="https://othmanelhammouchi.com/posts/mumford-shah-equations/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-14T16:43:54+02:00"><meta property="article:modified_time" content="2022-08-14T16:43:54+02:00"><meta property="og:see_also" content="https://othmanelhammouchi.com/posts/mumford-shah-implementation/"><meta property="og:see_also" content="https://othmanelhammouchi.com/posts/mumford-shah-intro/"><link rel=canonical href=https://othmanelhammouchi.com/posts/mumford-shah-equations/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.38c4552ac40f9ae3408bad40358f654ebd8804412fe74ed56f2d6c8a7af82dd3.css integrity="sha256-OMRVKsQPmuNAi61ANY9lTr2IBEEv507Vby1sinr4LdM=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><script src=/js/mathjax-config.min.js></script>
<script type=text/javascript src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://othmanelhammouchi.com/>Othman El Hammouchi</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/contact/>Contact me</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://othmanelhammouchi.com/posts/mumford-shah-equations/>Mumford-Shah Segmentation: Deriving the Equations</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2022-08-14T16:43:54+02:00>August 14, 2022</time></span>
<span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
6-minute read</span></div><div class=authors><i class="fa-solid fa-user" aria-hidden=true></i>
<a href=/authors/othman-el-hammouchi/>Othman El Hammouchi</a></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/image-processing/>image processing</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/python/>Python</a></span></div></div></header><div class=post-content><p>In the previous post, we saw how the Mumford-Shah model finds a segmentation of an image $g$ by solving the variational problem</p><p>$$
\underset{(u, k) \in \mathcal{A}}{\rm{argmin}} \, J[u, K]
$$</p><p>where</p><p>$$
\begin{equation} \label{eq:ms-functional}
J[u, K] = \int_{\Omega}(u - g)^2 \, dx + \int_{\Omega \setminus K}\left \Vert \nabla u \right \Vert ^2 \, dx + \mathcal{H}^1(K)
\end{equation}
$$</p><p>is the Mumford-Shah functional and</p><p>$$
\mathcal{A} = \left \lbrace (u, K) \ \vert \ K \subseteq \Omega \ \text{closed}, \ u \in C^1(\Omega \setminus K) \right \rbrace
$$</p><p>is the set of candidate segmentations. We now need to convert this into a form which can be implemented numerically. Luckily, there is a standard way of doing this for variational problems, namely by deriving an equivalent system of PDEs known as the <em>Euler-Lagrange equations</em>. The method originates in analytical mechanics, which uses the energy of a system (instead of vector forces) to describe its time-evolution. If $\boldsymbol{q}: [t_1, t_2] \rightarrow \mathbb{R}^N$ represents the state of a system described by a Lagrangian $\mathcal{L}$ moving from point $\boldsymbol{a}$ to $\boldsymbol{b}$ in phase space, then analytical mechanics tells us that $\boldsymbol{q}$ must be a stationary point of the so-called <em>action</em> of the system,</p><p>$$
\mathcal{S}[q] : = \int_{t_1}^{t_2} \mathcal{L}(t, \boldsymbol{q}, \dot{\boldsymbol{q}}) \, dt \,,
$$</p><p>within the space of possible paths. This is known as the <em>principle of stationary action</em>. In other words, there exists a neighbourhood of $\boldsymbol{q}$ such that sufficiently small perturbations $\delta \boldsymbol{q} = \epsilon \boldsymbol{\eta}$ which leave the endpoints fixed would cause the value of $\mathcal{S}$ to increase, meaning that the function</p><p>$$
\Phi(\epsilon) := \mathcal{S}[\boldsymbol{q} + \epsilon \boldsymbol{\eta}] \,,
$$</p><p>defined on a suitably small interval $(-\epsilon_0, \epsilon_0)$, reaches a minimum for $\epsilon = 0$. This is just an ordinary real function of a single variable, and we know from elementary calculus that a necessary condition for $\Phi$ attaining a minimum is that its derivative must vanish at 0, i.e. $\Phi&rsquo;(0) = 0$. Writing this out explicitly and using some calculus gymnastics, it can be show that this is equivalent to requiring that $\boldsymbol{q}$ satisfy the equations</p><p>$$
\frac{\partial \mathcal{L}}{\partial q_i} = \frac{d}{dt}\frac{\partial \mathcal{L}}{\partial \dot{q_i}} \quad i \in {1, 2, 3 }\,,
$$</p><p>turning our original variational problem into a system of PDEs.</p><script src=js/plyr.js></script>
<script>const player=new Plyr("#player")</script><video id=player width=100% playsinline controls autoplay>
<source src=perturbation.mp4 type=video/mp4><source src=perturbation.webm type=video/webm></video><p>In attempting to apply this method to equation \ref{eq:ms-functional}, the main obstacle we face is the presence of the term $\mathcal{H}^1(K)$, which cannot be absorbed into a Lagrangian. Once again, however, physics comes to our rescue. Specifically, we will address this issue by borrowing ideas which have their origin in the study of <em>phase seperation</em>.</p><p>Suppose we are given a container $\Omega$ holding two immiscible fluids, such as oil and water, and we are interested in their final configuration at equilibrium. In order to distinguish between these phases, we arbitrarily fix one of them and introduce a so-called order parameter $u: \Omega \rightarrow [0, 1]$ indicating the strength of its presence, with 0 meaning complete abscence and 1 total purity. The classical theory of phase transition then states that the fluids will arrange themselves so as to minimise the length of their interface, which is given by the Hausdorff measure $\mathcal{H}^1(S_u)$ of the discontinuity set of $u$. Implicit in this point of view is the assumption that this transition occurs instantly, i.e. $u$ is an indicator function taking values in ${0, 1 }$.</p><p>An alternative approach was proposed by the researchers Cahn and Hilliard, who instead chose to model the transition as occuring gradually in a thin layer between the pure bulk volumes. In this case, the equilibrium configuration will minimise the energy</p><p>$$
E_\epsilon[u] := \int_\Omega \left( \epsilon \Vert \nabla u \Vert^2 \, + \frac{u^2(1-u)^2}{\epsilon} \right) dx
$$</p><p>for some small constant $\epsilon$ controlling the width of the transition layer.</p><p>Heuristically, this functional is composed of two parts pulling in opposite directions, with the second term penalising the failure of $u$ to be binary, and the first term counteracting this by disincentivising steep slopes. As $\epsilon$ tends to 0, the former will come to dominate over the latter, which would suggest that an associated sequence of minimisers $(u_\epsilon)_\epsilon$ would converge to the indicator function $I_A$ of some subset of $\Omega$. This was formally established by the mathematicians Mordica and Mortola, who additionally showed that $I_A$ is a minimiser of the classical formulation and</p><p>$$
E_\epsilon (u_\epsilon) \xrightarrow{\epsilon \to 0} \mathcal{H}^1(\partial^* A) \,,
$$</p><p>i.e. the Cahn-Hilliard energies converge to the length of the (essential) boundary of $A$. Given that $K = S_u$ in the Mumford-Shah functional, this result gives us a way to approximate the problematic term by a series of more suitable expressions. This was done by two different mathematicians, Ambrosio and Tortorelli, who arrived at the family of the functionals</p><p>$$
AT_\epsilon[u, v] := \int_\Omega (u - g)^2 \, dx + \int_\Omega v^2 \Vert \nabla u \Vert^2 \, dx + \int_\Omega \left(\epsilon \Vert \nabla v \Vert^2 + \frac{(1 - v)^2}{4\epsilon} \right) \, dx \,
$$</p><p>with the additional function $v$ serving to approximate the discontinuity set here. For a fixed $\epsilon$, the Lagrangian is given by</p><p>$$
\mathcal{L}(x, y, u, v, u_x, \dots, v_y) = (u - g)^2 + v^2 \Vert \nabla u \Vert^2 + \epsilon \Vert \nabla v \Vert^2 + \frac{(1 - v)^2}{4\epsilon} \,,
$$</p><p>which we can now use to derive a corresponding system of PDEs. Because we&rsquo;re dealing with functions of multiple variables, i.e. $\mathcal{L} = \mathcal{L}(x_1, \dots, x_m, \boldsymbol{q}(x_1, \dots, x_m), (q_1)_{x_1}, \dots, (q_n)_{x_m})$, we will need to use the following slight generalisation of Euler-Lagrange:</p><p>$$
\frac{\partial \mathcal{L}}{\partial q_i} = \sum_{i = j}^m \frac{\partial}{\partial x_j}\frac{\partial \mathcal{L}}{\partial (q_i)_{x_j}} \quad i \in {1, 2, 3 }\,.
$$</p><p>We differentiate with respect to $u$ to obtain</p><p>$$
\begin{cases}
\displaystyle
\frac{\partial \mathcal{L}}{\partial u} = 2(u - g) \\[1em]
\displaystyle
\frac{\partial \mathcal{L}}{\partial u_x} = 2v^2u_x \\[1em]
\displaystyle
\frac{\partial \mathcal{L}}{\partial u_y} = 2v^2u_y \\[1em]
\frac{\partial}{\partial x}\frac{\partial \mathcal{L}}{\partial u_x} + \frac{\partial }{\partial x}\frac{\partial \mathcal{L}}{\partial u_y} = \left( \frac{\partial}{\partial x}, \frac{\partial}{\partial x}\right) \cdot \left( 2v^2u_x, 2v^2u_y \right) \,,
\end{cases}
$$</p><p>leading to the equation</p><p>$$
(u - g) - \nabla \cdot (v^2 \nabla u) = 0 \,.
$$</p><p>Similarly, differentiating with respect to $v$ yields</p><p>$$
\begin{cases}
\displaystyle
\frac{\partial \mathcal{L}}{\partial v} = 2v \Vert \nabla u \Vert^2 \\[1em]
\displaystyle
\frac{d}{dx}\frac{\partial \mathcal{L}}{\partial v_x} = \frac{d}{dx}(2\epsilon v_x) = 2\epsilon v_{xx} \\[1em]
\displaystyle
\frac{d}{dy}\frac{\partial \mathcal{L}}{\partial v_y} = \frac{d}{dy}(2\epsilon v_y) = 2\epsilon v_{yy} \,,
\end{cases}
$$</p><p>from which we get</p><p>$$
v \Vert \nabla u \Vert^2 - \frac{(1 - v)}{4\epsilon} - \epsilon \Delta v = 0 \,.
$$</p><p>Putting these together, we finally arrive at the system</p><p>$$
\begin{cases}
\displaystyle
(u - g) - \nabla \cdot (v^2 \nabla u) = 0 \\[1em]
\displaystyle
v \Vert \nabla u \Vert^2 - \frac{1 - v}{4\epsilon} - \epsilon \Delta v = 0 \,,
\end{cases}
$$</p><p>which is simply a pair of PDEs.</p><p>In the next post, we will implement a numerical scheme to solve these equations.</p></div><footer><section class=see-also><h3 id=see-also-in-mumford-shah-image-segmentation>See also in Mumford-Shah Image Segmentation
<a class=heading-link href=#see-also-in-mumford-shah-image-segmentation><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><nav><ul><li><a href=/posts/mumford-shah-implementation/>Mumford Shah Segmentation: Implementing the Algorithm</a></li><li><a href=/posts/mumford-shah-intro/>Image Segmentation using the Mumford-Shah functional</a></li></ul></nav></section></footer></article></section></div><footer class=footer><section class=container>©
2022 -
2024
Othman El Hammouchi
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
<script src=/js/plyr.min.8537ca66f236f20d383a4be510f5da50a2bd3d7c4464b11f1968461eefaf00d1.js integrity="sha256-hTfKZvI28g04OkvlEPXaUKK9PXxEZLEfGWhGHu+vANE="></script>
<script src=/js/mathjax-config.min.3b9893c399025c9bd37a95cbd1a323be25402140dba10377bf23467199a66f7e.js integrity="sha256-O5iTw5kCXJvTepXL0aMjviVAIUDboQN3vyNGcZmmb34="></script></body></html>