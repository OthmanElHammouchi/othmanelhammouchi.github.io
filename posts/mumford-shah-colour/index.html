<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Encore: segmenting colour images with Mumford-Shah · Othman El Hammouchi
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Othman El Hammouchi">
<meta name="description" content="I wanted to write a final post in my series on Mumford-Shah segmentation to explain how the approach we detailed so far could be extended for colour images. This time, our working example will be this charming picture of Paul Erdős with child prodigy Terrence Tao:
Mathematics transcending age barriers
In this case, both our image and cartoon will have three components (one for each primary colour),
$$ \begin{cases} \boldsymbol{g} = (g_1, g_2, g_3) \\[2em] \boldsymbol{u} = (u_1, u_2, u_3) \end{cases} $$">
<meta name="keywords" content="blog,developer,data science,personal">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Encore: segmenting colour images with Mumford-Shah"/>
<meta name="twitter:description" content="I wanted to write a final post in my series on Mumford-Shah segmentation to explain how the approach we detailed so far could be extended for colour images. This time, our working example will be this charming picture of Paul Erdős with child prodigy Terrence Tao:
Mathematics transcending age barriers
In this case, both our image and cartoon will have three components (one for each primary colour),
$$ \begin{cases} \boldsymbol{g} = (g_1, g_2, g_3) \\[2em] \boldsymbol{u} = (u_1, u_2, u_3) \end{cases} $$"/>

<meta property="og:title" content="Encore: segmenting colour images with Mumford-Shah" />
<meta property="og:description" content="I wanted to write a final post in my series on Mumford-Shah segmentation to explain how the approach we detailed so far could be extended for colour images. This time, our working example will be this charming picture of Paul Erdős with child prodigy Terrence Tao:
Mathematics transcending age barriers
In this case, both our image and cartoon will have three components (one for each primary colour),
$$ \begin{cases} \boldsymbol{g} = (g_1, g_2, g_3) \\[2em] \boldsymbol{u} = (u_1, u_2, u_3) \end{cases} $$" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://othmanelhammouchi.com/posts/mumford-shah-colour/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-04-21T16:51:00+02:00" />
<meta property="article:modified_time" content="2024-04-21T16:51:00+02:00" />
<meta property="og:see_also" content="https://othmanelhammouchi.com/posts/mumford-shah-implementation/" /><meta property="og:see_also" content="https://othmanelhammouchi.com/posts/mumford-shah-equations/" /><meta property="og:see_also" content="https://othmanelhammouchi.com/posts/mumford-shah-intro/" />





<link rel="canonical" href="https://othmanelhammouchi.com/posts/mumford-shah-colour/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.38c4552ac40f9ae3408bad40358f654ebd8804412fe74ed56f2d6c8a7af82dd3.css" integrity="sha256-OMRVKsQPmuNAi61ANY9lTr2IBEEv507Vby1sinr4LdM=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









<script src="/js/mathjax-config.min.js" defer></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" defer></script>





</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://othmanelhammouchi.com/">
      Othman El Hammouchi
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/contact/">Contact me</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://othmanelhammouchi.com/posts/mumford-shah-colour/">
              Encore: segmenting colour images with Mumford-Shah
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2024-04-21T16:51:00&#43;02:00">
                April 21, 2024
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              2-minute read
            </span>
          </div>
          <div class="authors">
  <i class="fa-solid fa-user" aria-hidden="true"></i>
    <a href="/authors/othman-el-hammouchi/">Othman El Hammouchi</a></div>

          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/image-processing/">image processing</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/python/">Python</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p>I wanted to write a final post in my series on Mumford-Shah segmentation to explain how the <a href="https://othmanelhammouchi.com/posts/mumford-shah-implementation/" >approach</a> we detailed so far could be extended for colour images. This time, our working example will be this charming picture of <a href="https://www.reddit.com/r/math/comments/2ftoyi/paul_erd%C5%91s_and_terry_tao_in_1985_tt_was_10_when/"  class="external-link" target="_blank" rel="noopener">Paul Erdős with child prodigy Terrence Tao</a>:</p>
<figure><img src="erdos-tao.jpg"
         alt="Mathematics transcending age barriers" width="50%"/><figcaption>
            <p>Mathematics transcending age barriers</p>
        </figcaption>
</figure>

<p>In this case, both our image and cartoon will have three components (one for each primary colour),</p>
<p>$$
\begin{cases}
\boldsymbol{g} = (g_1, g_2, g_3) \\[2em]
\boldsymbol{u} = (u_1, u_2, u_3)
\end{cases}
$$</p>
<p>hence we have to adapt our loss functional to penalise the total deviation in every component:</p>
<p>$$
J[u, K] := \int_{\Omega} \sum_{i = 1}^3 (u_i - g_i)^2 \, dx + \int_    {\Omega \setminus K}\left \Vert \frac{\partial (u_1, u_2, u_3)}{\partial (x_1, x_2)} \right \Vert_F ^2 \, dx + \mathcal{H}^1(K) \,.
$$</p>
<p>where $\Vert \cdot \Vert_F$ denotes the <em>Frobenius norm</em>. The linearity of the integration allows us to derive the PDE system and weak form equations in the same way as for the [grayscale case]({{ ref &ldquo;/posts/mumford-shah-equations&rdquo; }}), yielding the following UFL expressions.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>        u1 <span style="color:#f92672">*</span> w1
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">+</span> (v<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">*</span> dot(grad(u1), grad(w1))
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">+</span> u2 <span style="color:#f92672">*</span> w2
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">+</span> (v<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">*</span> dot(grad(u2), grad(w2))
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">+</span> u3 <span style="color:#f92672">*</span> w3
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">+</span> (v<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">*</span> dot(grad(u3), grad(w3))
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">*</span> dx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    L <span style="color:#f92672">=</span> (g1 <span style="color:#f92672">*</span> w1 <span style="color:#f92672">+</span> g2 <span style="color:#f92672">*</span> w2 <span style="color:#f92672">+</span> g3 <span style="color:#f92672">*</span> w3) <span style="color:#f92672">*</span> dx</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>        v <span style="color:#f92672">*</span> inner(grad(u), grad(u)) <span style="color:#f92672">*</span> w <span style="color:#f92672">*</span> dx
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">+</span> v <span style="color:#f92672">*</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> eps) <span style="color:#f92672">*</span> w <span style="color:#f92672">*</span> dx
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">-</span> eps <span style="color:#f92672">*</span> dot(grad(v), grad(w)) <span style="color:#f92672">*</span> dx
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    L <span style="color:#f92672">=</span> fem<span style="color:#f92672">.</span>Constant(domain, <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> eps)) <span style="color:#f92672">*</span> w <span style="color:#f92672">*</span> dx</span></span></code></pre></div>
<p>We can again solve the equations through alternating iteration. Here is the result:</p>
<figure>
	<div class="multi-image">
		<img src="colour_cartoon.png", width="40%">
		<img src="colour_edges.png", width="40%">
	</div>
    <figcaption><p>Segmentation of Tao-Erdos picture</p></figcaption>
</figure>
<p>Not too shabby if you ask me!</p>

      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3 id="see-also-in-mumford-shah-image-segmentation">
        See also in Mumford Shah Image Segmentation
        <a class="heading-link" href="#see-also-in-mumford-shah-image-segmentation">
          <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
          <span class="sr-only">Link to heading</span>
        </a>
      </h3>
      <nav>
        <ul>
        
        
          
        
          
            <li>
              <a href="/posts/mumford-shah-implementation/">Mumford Shah Segmentation: Implementing the Algorithm</a>
            </li>
          
        
          
            <li>
              <a href="/posts/mumford-shah-equations/">Mumford-Shah Segmentation: Deriving the Equations</a>
            </li>
          
        
          
            <li>
              <a href="/posts/mumford-shah-intro/">Image Segmentation using the Mumford-Shah functional</a>
            </li>
          
        
        </ul>
      </nav>
    
  
</section>


        
        
        
        
        

        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2022 -
    
    2024
     Othman El Hammouchi 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  
  
  
  <script src="/js/plyr.min.8537ca66f236f20d383a4be510f5da50a2bd3d7c4464b11f1968461eefaf00d1.js" integrity="sha256-hTfKZvI28g04OkvlEPXaUKK9PXxEZLEfGWhGHu&#43;vANE="></script>
  
  
  
  
  <script src="/js/mathjax-config.min.3b9893c399025c9bd37a95cbd1a323be25402140dba10377bf23467199a66f7e.js" integrity="sha256-O5iTw5kCXJvTepXL0aMjviVAIUDboQN3vyNGcZmmb34="></script>
  
  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
