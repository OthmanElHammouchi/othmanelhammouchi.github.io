<!doctype html><html lang=en><head><title>Mumford-Shah Image Segmentation - Introduction · Othman El Hammouchi</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Othman El Hammouchi"><meta name=description content="This is the first in a series of articles about the Mumford-Shah model for variational image segmentation.
Segmentation is the process of partitioning an image into a set of regions representing different surfaces and determining the contours which seperate them. This results in a simplified representation (often called a cartoon) which can then be used in all manner of downstream tasks, from medical imaging tools for assisting physicians to computer vision models."><meta name=keywords content="blog,developer,data science,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Mumford-Shah Image Segmentation - Introduction"><meta name=twitter:description content="This is the first in a series of articles about the Mumford-Shah model for variational image segmentation.
Segmentation is the process of partitioning an image into a set of regions representing different surfaces and determining the contours which seperate them. This results in a simplified representation (often called a cartoon) which can then be used in all manner of downstream tasks, from medical imaging tools for assisting physicians to computer vision models."><meta property="og:title" content="Mumford-Shah Image Segmentation - Introduction"><meta property="og:description" content="This is the first in a series of articles about the Mumford-Shah model for variational image segmentation.
Segmentation is the process of partitioning an image into a set of regions representing different surfaces and determining the contours which seperate them. This results in a simplified representation (often called a cartoon) which can then be used in all manner of downstream tasks, from medical imaging tools for assisting physicians to computer vision models."><meta property="og:type" content="article"><meta property="og:url" content="https://othmanelhammouchi.com/posts/mumford-shah-intro/mumford-shah-intro/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-14T16:43:53+02:00"><meta property="article:modified_time" content="2022-08-14T16:43:53+02:00"><link rel=canonical href=https://othmanelhammouchi.com/posts/mumford-shah-intro/mumford-shah-intro/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.e1bdf152d93b060b06ba5d496486ed9c201a8b95d335e035beb5faebe3b61cad.css integrity="sha256-4b3xUtk7BgsGul1JZIbtnCAai5XTNeA1vrX66+O2HK0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Othman El Hammouchi</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/contact/>Contact me</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://othmanelhammouchi.com/posts/mumford-shah-intro/mumford-shah-intro/>Mumford-Shah Image Segmentation - Introduction</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2022-08-14T16:43:53+02:00>August 14, 2022</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
7-minute read</span></div></div></header><div class=post-content><p><em>This is the first in a series of articles about the Mumford-Shah model for variational image segmentation.</em></p><p>Segmentation is the process of partitioning an image into a set of regions representing different surfaces and determining the contours which seperate them. This results in a simplified representation (often called a cartoon) which can then be used in all manner of downstream tasks, from medical imaging tools for assisting physicians to computer vision models. The power of image segmentation (as with all data science applications) lies in its ability to condense information, reducing a high-dimensional input with lots of superfluous detail to a streamlined representation which can be more easily parsed and processed. Every segmentation model is fundamentally defined by how it chooses to make this tradeoff between accuracy and parsimony.</p><p>In this series of posts, we&rsquo;ll take a look at the model proposed by mathematicians David Mumford and Jayant Shah in one of the most cited papers in the image processing literature. It belongs to the family of so-called variational methods, which operate by minimising an energy functional on a space of candidate solutions (don&rsquo;t worry, we&rsquo;ll elaborate on this later). A major benefit of this approach in comparison with more recent neural network-based ones is that it requires no labelled training data, which can be difficult and costly to obtain, especially in specialised fields such as medicine. To get you excited for the math (which can be fairly heavy-duty in places), here&rsquo;s a sneak peek at the final result:</p><figure><div class=multi-image><img src=/assets/images/image.png></div><figcaption>Original image</figcaption></figure><figure><div class=multi-image><img src=/assets/images/edges.png>
<img src=/assets/images/cartoon.png></div><figcaption>Segmentation</figcaption></figure><p>Looks pretty cool, huh? This segmentation of <a href=https://perenflo.com/math class=external-link target=_blank rel=noopener>Per Enflo&rsquo;s famous goose award ceremony</a> was done using a numerical implementation of the Mumford-Shah model in Python, which we&rsquo;ll build up to in this and the next post.</p><p>To keep things simple, let&rsquo;s restrict our attention to grayscale images for starters. An image is then simply a function $g: \Omega \underset{\mathclap{\mathrm{open}}}{\subseteq} \mathbb{R}^2 \rightarrow \mathbb{R}$ which returns the light intensity at each point of a flat display. This display can be any bounded open subset of the plane, and we can choose $\Omega = [0, 1]^2$ for simplicity. The values which g assumes depend on the (arbitrary) scale used, and so may be normalised to lie between 0 and 1. Of course, in actual implementations, $g$ will be constrained to a discrete set of values depending on the bit-depth of the image, but this special case is included in the more general setting. Because real-life images typically are extremely erratic, we cannot place any restrictions on $g$ at this stage: it&rsquo;s allowed to be as irregular and ill-behaved as may be.</p><p>A segmentation of $g$ will be another image $u$ which approximates the original as closely as possible, while satisfying certain restrictions which constrain it to be a cartoon. The proximity requirement can be expressed by penalising the $L^2$-norm of the difference $\int_{\Omega}(u - g)^2 \, dx$, with the choice of norm motivated as usual by optimisation considerations. In order to obtain a cartoon of the original, we need $u$ to smooth out the interior of surfaces while preserving the boundary between them. In other words, it should be a regular function outside of an edge set $K \underset{\mathclap{\mathrm{closed}}}{\subseteq} \Omega$ where it makes a sudden jump. The challenging part is how to differentiate abrupt intra-surface variations from real transitions.</p><p>The Mumford-Shah approach tackles this problem by introducing both the norm $\Vert \nabla u \Vert$ of the gradient as well as the length $\mathcal{H}^1(K)$ of the discontinuity set as additional regularising penalty terms (here $\mathcal{H}^1$ denotes the 1-dimensional Hausdorff measure, a generalisation of the notion of length to irregular curves such as fractals). The idea is to force $u$ to have singularities only where they are &lsquo;most needed&rsquo;. To illustrate this, consider the following two sigmoid-like surfaces:</p><p>Both make a transition from 1 to 0, but the one on the left does so much more gently. If these represented the images we were cartooning, then choosing $u \coloneqq g$ would incur a much greater penalty for the right mapping than the left, because of a blowup in the gradient term. Introducing a jump discontinuity along the line where the sharp drop-off occurs and taking $u$ to be an (almost) piecewise constant function would probably lead to an improvement in the penalty.</p><p>Putting these three terms together, we are now able to fully state the Mumford-Shah model. For a given image $g$, its segmentation and edge set are obtained as the pair $(u, K) \in C^1(\Omega \setminus K) \times \mathcal{F}(\Omega)$ which minimises the <em>Mumford-Shah functional</em></p><p>$$
J[u, K] := \int_{\Omega}(u - g)^2 \, dx + \int_{\Omega \setminus K}\left \Vert \nabla u \right \Vert ^2 \, dx + \mathcal{H}^1(K) \,.
$$</p><p>The term &ldquo;functional&rdquo; is simply a fancy name given to a function which takes other functions as inputs. The Riemann integral from elementary calculus is an example of a functional: it maps functions $f \in C([a, b])$ to the real number $\int_a^b f(x) \, dx$. Finding minimisers of functionals is well-established problem within mathematics and is
the subject of a field called <em>variational calculus</em> (the reason for this naming will become clear in the next post).</p><p>Of course, we have yet to show the actual existence of a minimising pair for the Mumford-Shah functional, without which our segmentation definition would be entirely vacuous. This turns out to be a rather hard problem, requiring a lot of involved mathematical machinery to tackle. If you&rsquo;re interested in the technical details, they were the subject of my undergraduate thesis, which you can find [here]({{ site.url }}/assets/mumford_shah_thesis.pdf) if you&rsquo;re feeling adventurous.</p><p>The topic is not just of theoretical interest either: if you want to maintain your sanity when writing a software implementation of this algorithm, it&rsquo;s quite helpful to know that your solver&rsquo;s failure to convergence is caused by a bug, and not because it&rsquo;s searching for something which doesn&rsquo;t exist. A famous example of a functional without minimiser is due to Weierstrass:</p><p>$$
J[u] = \int_{-1}^1 (t \frac{du}{dt})^2 \, dt
$$</p><p>defined on the class of functions</p><p>$$
\mathcal{A} := \left \lbrace u \in C^1((-1, 1)) \mid u(-1) = -1, u(1) = 1 \right \rbrace
$$</p><p>It is clear that $J[u] \geq 0$ for any $u$. Moreover, it can be shown that $J[u_\epsilon] \xrightarrow{\epsilon \to 0} 0$ for the sequence</p><p>$$
u_{\epsilon}(t) := \frac{\arctan(t/\epsilon)}{\arctan(1/\epsilon)}
$$</p><p>as illustrated numerically in the following animation:</p><div style=display:flex;justify-content:center><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css><script language=javascript>function isInternetExplorer(){return ua=navigator.userAgent,ua.indexOf("MSIE ")>-1||ua.indexOf("Trident/")>-1}function Animation(e,t,n,s,o){this.img_id=t,this.slider_id=n,this.loop_select_id=o,this.interval=s,this.current_frame=0,this.direction=0,this.timer=null,this.frames=new Array(e.length);for(var a,i=0;i<e.length;i++)this.frames[i]=new Image,this.frames[i].src=e[i];a=document.getElementById(this.slider_id),a.max=this.frames.length-1,isInternetExplorer()&&(a.setAttribute("onchange",a.getAttribute("oninput")),a.setAttribute("oninput",null)),this.set_frame(this.current_frame)}Animation.prototype.get_loop_state=function(){for(var t,n=document[this.loop_select_id].state,e=0;e<n.length;e++)if(t=n[e],t.checked)return t.value},Animation.prototype.set_frame=function(e){this.current_frame=e,document.getElementById(this.img_id).src=this.frames[this.current_frame].src,document.getElementById(this.slider_id).value=this.current_frame},Animation.prototype.next_frame=function(){this.set_frame(Math.min(this.frames.length-1,this.current_frame+1))},Animation.prototype.previous_frame=function(){this.set_frame(Math.max(0,this.current_frame-1))},Animation.prototype.first_frame=function(){this.set_frame(0)},Animation.prototype.last_frame=function(){this.set_frame(this.frames.length-1)},Animation.prototype.slower=function(){this.interval/=.7,this.direction>0?this.play_animation():this.direction<0&&this.reverse_animation()},Animation.prototype.faster=function(){this.interval*=.7,this.direction>0?this.play_animation():this.direction<0&&this.reverse_animation()},Animation.prototype.anim_step_forward=function(){if(this.current_frame+=1,this.current_frame<this.frames.length)this.set_frame(this.current_frame);else{var e=this.get_loop_state();e=="loop"?this.first_frame():e=="reflect"?(this.last_frame(),this.reverse_animation()):(this.pause_animation(),this.last_frame())}},Animation.prototype.anim_step_reverse=function(){if(this.current_frame-=1,this.current_frame>=0)this.set_frame(this.current_frame);else{var e=this.get_loop_state();e=="loop"?this.last_frame():e=="reflect"?(this.first_frame(),this.play_animation()):(this.pause_animation(),this.first_frame())}},Animation.prototype.pause_animation=function(){this.direction=0,this.timer&&(clearInterval(this.timer),this.timer=null)},Animation.prototype.play_animation=function(){this.pause_animation(),this.direction=1;var e=this;this.timer||(this.timer=setInterval(function(){e.anim_step_forward()},this.interval))},Animation.prototype.reverse_animation=function(){this.pause_animation(),this.direction=-1;var e=this;this.timer||(this.timer=setInterval(function(){e.anim_step_reverse()},this.interval))}</script><style>.animation{display:inline-block;text-align:center}input[type=range].anim-slider{width:374px;margin-left:auto;margin-right:auto}.anim-buttons{margin:8px 0}.anim-buttons button{padding:0;width:36px}.anim-state label{margin-right:8px}.anim-state input{margin:0;vertical-align:middle}</style><div class=animation><img id=_anim_img79c69763a6b947d0a0ad5e4f50cc0113><div class=anim-controls><input id=_anim_slider79c69763a6b947d0a0ad5e4f50cc0113 type=range class=anim-slider name=points min=0 max=1 step=1 value=0 oninput=anim79c69763a6b947d0a0ad5e4f50cc0113.set_frame(parseInt(this.value))><div class=anim-buttons><button title="Decrease speed" aria-label="Decrease speed" onclick=anim79c69763a6b947d0a0ad5e4f50cc0113.slower()>
<i class="fa fa-minus"></i></button>
<button title="First frame" aria-label="First frame" onclick=anim79c69763a6b947d0a0ad5e4f50cc0113.first_frame()>
<i class="fa fa-fast-backward"></i></button>
<button title="Previous frame" aria-label="Previous frame" onclick=anim79c69763a6b947d0a0ad5e4f50cc0113.previous_frame()>
<i class="fa fa-step-backward"></i></button>
<button title="Play backwards" aria-label="Play backwards" onclick=anim79c69763a6b947d0a0ad5e4f50cc0113.reverse_animation()>
<i class="fa fa-play fa-flip-horizontal"></i></button>
<button title=Pause aria-label=Pause onclick=anim79c69763a6b947d0a0ad5e4f50cc0113.pause_animation()>
<i class="fa fa-pause"></i></button>
<button title=Play aria-label=Play onclick=anim79c69763a6b947d0a0ad5e4f50cc0113.play_animation()>
<i class="fa fa-play"></i></button>
<button title="Next frame" aria-label="Next frame" onclick=anim79c69763a6b947d0a0ad5e4f50cc0113.next_frame()>
<i class="fa fa-step-forward"></i></button>
<button title="Last frame" aria-label="Last frame" onclick=anim79c69763a6b947d0a0ad5e4f50cc0113.last_frame()>
<i class="fa fa-fast-forward"></i></button>
<button title="Increase speed" aria-label="Increase speed" onclick=anim79c69763a6b947d0a0ad5e4f50cc0113.faster()>
<i class="fa fa-plus"></i></button></div><form title="Repetition mode" aria-label="Repetition mode" action=#n name=_anim_loop_select79c69763a6b947d0a0ad5e4f50cc0113 class=anim-state><input type=radio name=state value=once id=_anim_radio1_79c69763a6b947d0a0ad5e4f50cc0113>
<label for=_anim_radio1_79c69763a6b947d0a0ad5e4f50cc0113>Once</label>
<input type=radio name=state value=loop id=_anim_radio2_79c69763a6b947d0a0ad5e4f50cc0113 checked>
<label for=_anim_radio2_79c69763a6b947d0a0ad5e4f50cc0113>Loop</label>
<input type=radio name=state value=reflect id=_anim_radio3_79c69763a6b947d0a0ad5e4f50cc0113>
<label for=_anim_radio3_79c69763a6b947d0a0ad5e4f50cc0113>Reflect</label></form></div></div><script language=javascript>(function(){for(var n="_anim_img79c69763a6b947d0a0ad5e4f50cc0113",s="_anim_slider79c69763a6b947d0a0ad5e4f50cc0113",o="_anim_loop_select79c69763a6b947d0a0ad5e4f50cc0113",t=new Array(100),e=0;e<100;e++)t[e]="../dirichlet-frames/frame"+("0000000"+e).slice(-7)+".png";setTimeout(function(){anim79c69763a6b947d0a0ad5e4f50cc0113=new Animation(t,n,s,16,o)},0)})()</script></div><p>Thus, we can conclude that $\underset{u \in \mathcal{A}}{\inf}J(u)$ = 0, but this value is never attained, because any minimiser of $J$ must have a constant derivative equal to 0, and thus cannot take on different values at the endpoints. Looking at how the shape of $u_\epsilon$ evolves, we can see that its slope becomes steeper and steeper as it concentrates around 0 in an attempt to minimise the derivative on the rest of its domain.</p><p>This example also illustrates a common reason why functionals can fail to have a minimiser.</p><p>If we allowed this process reach its &ldquo;natural conclusion&rdquo;, we would exit the original space and obtain a step function with a jump at the origin. In other words, to obtain a solution, we have to <em>relax</em> the problem to impose <em>fewer constraints on the candidate solutions</em>, expanding the domain of $J$ to include piecewise differentiable candidate functions. Solutions obtained in this way are called <em>weak solutions</em>. We usually take the largest function space for which the problem remains well-defined in order to have maximal leeway in our search. If we succeed in finding a solution, our task then becomes to show that it is <em>regular</em>, i.e. that it satisfies the constraints of the original problem. An additional benefit of this approach is that it allows us to treat the two components seperately.</p><p>In the next post, we&rsquo;ll start putting this theoretical framework to some practical use by deriving the equations necessary for numerical minimisation of the Mumford-Shah functional.</p></div><footer></footer></article><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css integrity=sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0 crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js integrity=sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})'></script></section></div><footer class=footer><section class=container>©
2022 -
2024
Othman El Hammouchi
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>