<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Image Segmentation using the Mumford-Shah functional · Othman El Hammouchi
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Othman El Hammouchi">
<meta name="description" content="Segmentation is the process of partitioning an image into a set of regions representing different surfaces and determining the contours which seperate them. This results in a simplified representation (often called a cartoon) which can then be used in all manner of downstream tasks, from medical imaging tools for assisting physicians to computer vision models. The power of image segmentation (as with all data science applications) lies in its ability to condense information, reducing a high-dimensional input with lots of superfluous detail to a streamlined representation which can be more easily parsed and processed.">
<meta name="keywords" content="blog,developer,data science,personal">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Image Segmentation using the Mumford-Shah functional"/>
<meta name="twitter:description" content="Segmentation is the process of partitioning an image into a set of regions representing different surfaces and determining the contours which seperate them. This results in a simplified representation (often called a cartoon) which can then be used in all manner of downstream tasks, from medical imaging tools for assisting physicians to computer vision models. The power of image segmentation (as with all data science applications) lies in its ability to condense information, reducing a high-dimensional input with lots of superfluous detail to a streamlined representation which can be more easily parsed and processed."/>

<meta property="og:title" content="Image Segmentation using the Mumford-Shah functional" />
<meta property="og:description" content="Segmentation is the process of partitioning an image into a set of regions representing different surfaces and determining the contours which seperate them. This results in a simplified representation (often called a cartoon) which can then be used in all manner of downstream tasks, from medical imaging tools for assisting physicians to computer vision models. The power of image segmentation (as with all data science applications) lies in its ability to condense information, reducing a high-dimensional input with lots of superfluous detail to a streamlined representation which can be more easily parsed and processed." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://othmanelhammouchi.com/posts/mumford-shah-intro/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-14T16:43:53+02:00" />
<meta property="article:modified_time" content="2022-08-14T16:43:53+02:00" />
<meta property="og:see_also" content="https://othmanelhammouchi.com/posts/mumford-shah-colour/" /><meta property="og:see_also" content="https://othmanelhammouchi.com/posts/mumford-shah-implementation/" /><meta property="og:see_also" content="https://othmanelhammouchi.com/posts/mumford-shah-equations/" />





<link rel="canonical" href="https://othmanelhammouchi.com/posts/mumford-shah-intro/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.38c4552ac40f9ae3408bad40358f654ebd8804412fe74ed56f2d6c8a7af82dd3.css" integrity="sha256-OMRVKsQPmuNAi61ANY9lTr2IBEEv507Vby1sinr4LdM=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 
  
    
    <link rel="stylesheet" href="/css/custom.min.52d91a101a6ab58cf020be316d27176811417448320b5ca9399dc6f992e236de.css" integrity="sha256-UtkaEBpqtYzwIL4xbScXaBFBdEgyC1ypOZ3G&#43;ZLiNt4=" crossorigin="anonymous" media="screen" />
  





<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









<script src="/js/mathjax-config.min.js" defer></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" defer></script>





</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://othmanelhammouchi.com/">
      Othman El Hammouchi
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/contact/">Contact me</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://othmanelhammouchi.com/posts/mumford-shah-intro/">
              Image Segmentation using the Mumford-Shah functional
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2022-08-14T16:43:53&#43;02:00">
                August 14, 2022
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              6-minute read
            </span>
          </div>
          <div class="authors">
  <i class="fa-solid fa-user" aria-hidden="true"></i>
    <a href="/authors/othman-el-hammouchi/">Othman El Hammouchi</a></div>

          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/image-processing/">image processing</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/python/">Python</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p>Segmentation is the process of partitioning an image into a set of regions representing different surfaces and determining the contours which seperate them. This results in a simplified representation (often called a cartoon) which can then be used in all manner of downstream tasks, from medical imaging tools for assisting physicians to computer vision models. The power of image segmentation (as with all data science applications) lies in its ability to condense information, reducing a high-dimensional input with lots of superfluous detail to a streamlined representation which can be more easily parsed and processed. Every segmentation model is fundamentally defined by how it chooses to make this tradeoff between accuracy and parsimony.</p>
<p>In this series of posts, we&rsquo;ll take a look at the model proposed by mathematicians David Mumford and Jayant Shah in their <a href="https://dash.harvard.edu/bitstream/handle/1/3637121/Mumford_OptimalApproxPiece.pdf?sequence=1"  class="external-link" target="_blank" rel="noopener">widely cited paper</a>. It belongs to the family of so-called variational methods, which operate by minimising an energy functional on a space of candidate solutions (don&rsquo;t worry, we&rsquo;ll elaborate on this later). A major benefit of this approach in comparison with more recent neural network-based ones is that it requires no labelled training data, which can be difficult and costly to obtain, especially in specialised fields such as medicine. To get you excited for the heavy-duty math, here&rsquo;s a sneak peek at the final result:</p>
<figure><img src="per-enflo-goose.png"
         alt="Per Enflo receives a goose from Staniław Mazur" width="50%"/><figcaption>
            <p>Original image</p>
        </figcaption>
</figure>
<figure>
	<div class="multi-image">
		<img src="cartoon.png", width="40%">
		<img src="edges.png", width="40%">
	</div>
    <figcaption><p>Segmentation</p></figcaption>
</figure>
<p>Looks pretty cool, huh? This segmentation of <a href="https://perenflo.com/math"  class="external-link" target="_blank" rel="noopener">Per Enflo&rsquo;s famous goose award ceremony</a> was done using a numerical implementation of the Mumford-Shah model in Python, which we&rsquo;ll build up to in this and the next post.</p>
<p>To keep things simple, let&rsquo;s restrict our attention to grayscale images for starters. An image is then simply a function $g: \Omega \underset{\mathclap{\mathrm{open}}}{\subseteq} \mathbb{R}^2 \rightarrow \mathbb{R}$ which returns the light intensity at each point of a flat display. This display can be any bounded open subset of the plane, and we can choose $\Omega = [0, 1]^2$ for simplicity. The values which g assumes depend on the (arbitrary) scale used, and so may be normalised to lie between 0 and 1. Of course, in actual implementations, $g$ will be constrained to a discrete set of values depending on the bit-depth of the image, but this special case is included in the more general setting. Because real-life images typically are extremely erratic, we cannot place any restrictions on $g$ at this stage: it&rsquo;s allowed to be as irregular and ill-behaved as may be.</p>
<p>A segmentation of $g$ will be another image $u$ which approximates the original as closely as possible, while satisfying certain restrictions which constrain it to be a cartoon. The proximity requirement can be expressed by penalising the $L^2$-norm of the difference $\int_{\Omega}(u - g)^2 \, dx$, with the choice of norm motivated as usual by optimisation considerations. In order to obtain a cartoon of the original, we need $u$ to smooth out the interior of surfaces while preserving the boundary between them. In other words, it should be a regular function outside of an edge set $K \underset{\mathclap{\mathrm{closed}}}{\subseteq} \Omega$ where it makes a sudden jump. The challenging part is how to differentiate abrupt intra-surface variations from real transitions.</p>
<p>The Mumford-Shah approach tackles this problem by introducing both the norm $\Vert \nabla u \Vert$ of the gradient as well as the length $\mathcal{H}^1(K)$ of the discontinuity set as additional regularising penalty terms (here $\mathcal{H}^1$ denotes the 1-dimensional Hausdorff measure, a generalisation of the notion of length to irregular curves such as fractals). The idea is to force $u$ to have singularities only where they are &lsquo;most needed&rsquo;. To illustrate this, consider the following two sigmoid-like surfaces:</p>
<p>Both make a transition from 1 to 0, but the one on the left does so much more gently. If these represented the images we were cartooning, then choosing $u \coloneqq g$ would incur a much greater penalty for the right mapping than the left, because of a blowup in the gradient term. Introducing a jump discontinuity along the line where the sharp drop-off occurs and taking $u$ to be an (almost) piecewise constant function would probably lead to an improvement in the penalty.</p>
<p>Putting these three terms together, we are now able to fully state the Mumford-Shah model. For a given image $g$, its segmentation and edge set are obtained as the pair $(u, K) \in C^1(\Omega \setminus K) \times \mathcal{F}(\Omega)$ which minimises the <em>Mumford-Shah functional</em></p>
<p>$$
J[u, K] := \int_{\Omega}(u - g)^2 \, dx + \int_{\Omega \setminus K}\left \Vert \nabla u \right \Vert ^2 \, dx + \mathcal{H}^1(K) \,.
$$</p>
<p>The term &ldquo;functional&rdquo; is simply a fancy name given to a function which takes other functions as inputs. The Riemann integral from elementary calculus is an example of a functional: it maps functions $f \in C([a, b])$ to the real number $\int_a^b f(x) \, dx$. Finding minimisers of functionals is well-established problem within mathematics and is
the subject of a field called <em>variational calculus</em> (the reason for this naming will become clear in the next post).</p>
<p>Of course, we have yet to show the actual existence of a minimising pair for the Mumford-Shah functional, without which our segmentation definition would be entirely vacuous. This turns out to be a rather hard problem, requiring a lot of involved mathematical machinery to tackle. If you&rsquo;re interested in the technical details, they were the subject of my undergraduate thesis, which you can find <a href="/documents/mumford-shah-thesis.pdf" >here</a> if you&rsquo;re feeling adventurous.</p>
<p>The topic is not just of theoretical interest either: if you want to maintain your sanity when writing a software implementation of this algorithm, it&rsquo;s quite helpful to know that your solver&rsquo;s failure to convergence is caused by a bug, and not because it&rsquo;s searching for something which doesn&rsquo;t exist. A famous example of a functional without minimiser is due to Weierstrass:</p>
<p>$$
J[u] = \int_{-1}^1 (t \frac{du}{dt})^2 \, dt
$$</p>
<p>defined on the class of functions</p>
<p>$$
\mathcal{A} := \left \lbrace u \in C^1((-1, 1)) \mid u(-1) = -1, u(1) = 1 \right \rbrace
$$</p>
<p>It is clear that $J[u] \geq 0$ for any $u$. Moreover, it can be shown that $J[u_\epsilon] \xrightarrow{\epsilon \to 0} 0$ for the sequence</p>
<p>$$
u_{\epsilon}(t) := \frac{\arctan(t/\epsilon)}{\arctan(1/\epsilon)}
$$</p>
<p>as illustrated numerically in the following animation:</p>


<script src="/js/plyr.min.js"></script>
<script>
    const player = new Plyr('#player');
</script>
<video id="player" width="100%" playsinline controls autoplay>
    
    <source src="dirichlet.mp4" type="video/mp4" />
    
    <source src="dirichlet.webm" type="video/webm" />
    
</video>
<p>Thus, we can conclude that $\underset{u \in \mathcal{A}}{\inf}J(u)$ = 0, but this value is never attained, because any minimiser of $J$ must have a constant derivative equal to 0, and thus cannot take on different values at the endpoints. Looking at how the shape of $u_\epsilon$ evolves, we can see that its slope becomes steeper and steeper as it concentrates around 0 in an attempt to minimise the derivative on the rest of its domain.</p>
<p>This example also illustrates a common reason why functionals can fail to have a minimiser.</p>
<p>If we allowed this process reach its &ldquo;natural conclusion&rdquo;, we would exit the original space and obtain a step function with a jump at the origin. In other words, to obtain a solution, we have to <em>relax</em> the problem to impose <em>fewer constraints on the candidate solutions</em>, expanding the domain of $J$ to include piecewise differentiable candidate functions. Solutions obtained in this way are called <em>weak solutions</em>. We usually take the largest function space for which the problem remains well-defined in order to have maximal leeway in our search. If we succeed in finding a solution, our task then becomes to show that it is <em>regular</em>, i.e. that it satisfies the constraints of the original problem. An additional benefit of this approach is that it allows us to treat the two components seperately.</p>
<p>In the next post, we&rsquo;ll start putting this theoretical framework to some practical use by deriving the equations necessary for numerical minimisation of the Mumford-Shah functional.</p>

      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3 id="see-also-in-mumford-shah-image-segmentation">
        See also in Mumford-Shah Image Segmentation
        <a class="heading-link" href="#see-also-in-mumford-shah-image-segmentation">
          <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
          <span class="sr-only">Link to heading</span>
        </a>
      </h3>
      <nav>
        <ul>
        
        
          
            <li>
              <a href="/posts/mumford-shah-colour/">Encore: segmenting colour images with Mumford-Shah</a>
            </li>
          
        
          
            <li>
              <a href="/posts/mumford-shah-implementation/">Mumford Shah: Implementing the Algorithm</a>
            </li>
          
        
          
            <li>
              <a href="/posts/mumford-shah-equations/">Mumford-Shah: Deriving the Equations</a>
            </li>
          
        
          
        
        </ul>
      </nav>
    
  
</section>


        
        
        
        
        

        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2022 -
    
    2024
     Othman El Hammouchi 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  
  
  
  <script src="/js/plyr.min.8537ca66f236f20d383a4be510f5da50a2bd3d7c4464b11f1968461eefaf00d1.js" integrity="sha256-hTfKZvI28g04OkvlEPXaUKK9PXxEZLEfGWhGHu&#43;vANE="></script>
  
  
  
  
  <script src="/js/mathjax-config.min.3b9893c399025c9bd37a95cbd1a323be25402140dba10377bf23467199a66f7e.js" integrity="sha256-O5iTw5kCXJvTepXL0aMjviVAIUDboQN3vyNGcZmmb34="></script>
  
  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
